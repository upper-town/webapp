# NOTE: This config file is in 'sconf' format. Indent with tabs. Comments must be
# on their own line, they don't end a line. Do not escape or quote strings.
# Details: https://pkg.go.dev/github.com/mjl-/sconf.


# Domains for which email is accepted. For internationalized domains, use their
# IDNA names in UTF-8.
Domains:
	upper.town:

		# Hostname for client settings instead of the mail server hostname. E.g.
		# mail.<domain>. For future migration to another mail operator without requiring
		# all clients to update their settings, it is convenient to have client settings
		# that reference a subdomain of the hosted domain instead of the hostname of the
		# server where the mail is currently hosted. If empty, the hostname of the mail
		# server is used for client configurations. Unicode name. (optional)
		ClientSettingsDomain: mail.upper.town

		# If not empty, only the string before the separator is used to for email delivery
		# decisions. For example, if set to "+", you+anything@example.com will be
		# delivered to you@example.com. (optional)
		LocalpartCatchallSeparator: +

		# With DKIM signing, a domain is taking responsibility for (content of) emails it
		# sends, letting receiving mail servers build up a (hopefully positive) reputation
		# of the domain, which can help with mail delivery. (optional)
		DKIM:

			# Emails can be DKIM signed. Config parameters are per selector. A DNS record must
			# be created for each selector. Add the name to Sign to use the selector for
			# signing messages.
			Selectors:
				mail:

					# Period a signature is valid after signing, as duration, e.g. 72h. The period
					# should be enough for delivery at the final destination, potentially with several
					# hops/relays. In the order of days at least. (optional)
					Expiration: 72h

					# Either an RSA or ed25519 private key file in PKCS8 PEM form.
					PrivateKeyFile: dkim_domainkey_mail.pem

			# List of selectors that emails will be signed with. (optional)
			Sign:
				- mail

		# With DMARC, a domain publishes, in DNS, a policy on how other mail servers
		# should handle incoming messages with the From-header matching this domain and/or
		# subdomain (depending on the configured alignment). Receiving mail servers use
		# this to build up a reputation of this domain, which can help with mail delivery.
		# A domain can also publish an email address to which reports about DMARC
		# verification results can be sent by verifying mail servers, useful for
		# monitoring. Incoming DMARC reports are automatically parsed, validated, added to
		# metrics and stored in the reporting database for later display in the admin web
		# pages. (optional)
		DMARC:

			# Address-part before the @ that accepts DMARC reports. Must be
			# non-internationalized. Recommended value: dmarcreports.
			Localpart: dmarcreports

			# Account to deliver to.
			Account: postmaster

			# Mailbox to deliver to, e.g. DMARC.
			Mailbox: DMARC

		# MTA-STS is a mechanism that allows publishing a policy with requirements for
		# WebPKI-verified SMTP STARTTLS connections for email delivered to a domain.
		# Existence of a policy is announced in a DNS TXT record (often
		# unprotected/unverified, MTA-STS's weak spot). If a policy exists, it is fetched
		# with a WebPKI-verified HTTPS request. The policy can indicate that
		# WebPKI-verified SMTP STARTTLS is required, and which MX hosts (optionally with a
		# wildcard pattern) are allowd. MX hosts to deliver to are still taken from DNS
		# (again, not necessarily protected/verified), but messages will only be delivered
		# to domains matching the MX hosts from the published policy. Mail servers look up
		# the MTA-STS policy when first delivering to a domain, then keep a cached copy,
		# periodically checking the DNS record if a new policy is available, and fetching
		# and caching it if so. To update a policy, first serve a new policy with an
		# updated policy ID, then update the DNS record (not the other way around). To
		# remove an enforced policy, publish an updated policy with mode "none" for a long
		# enough period so all cached policies have been refreshed (taking DNS TTL and
		# policy max age into account), then remove the policy from DNS, wait for TTL to
		# expire, and stop serving the policy. (optional)
		MTASTS:

			# Policies are versioned. The version must be specified in the DNS record. If you
			# change a policy, first change it here to update the served policy, then update
			# the DNS record with the updated policy ID.
			PolicyID: 20251112T002316

			# If set to "enforce", a remote SMTP server will not deliver email to us if it
			# cannot make a WebPKI-verified SMTP STARTTLS connection. In mode "testing",
			# deliveries can be done without verified TLS, but errors will be reported through
			# TLS reporting. In mode "none", verified TLS is not required, used for phasing
			# out an MTA-STS policy.
			Mode: enforce

			# How long a remote mail server is allowed to cache a policy. Typically 1 or
			# several weeks.
			MaxAge: 24h0m0s

			# List of server names allowed for SMTP. If empty, the configured hostname is set.
			# Host names can contain a wildcard (*) as a leading label (matching a single
			# label, e.g. *.example matches host.example, not sub.host.example). (optional)
			MX:
				- upper.town

		# With TLSRPT a domain specifies in DNS where reports about encountered SMTP TLS
		# behaviour should be sent. Useful for monitoring. Incoming TLS reports are
		# automatically parsed, validated, added to metrics and stored in the reporting
		# database for later display in the admin web pages. (optional)
		TLSRPT:

			# Address-part before the @ that accepts TLSRPT reports. Recommended value:
			# tlsreports.
			Localpart: tlsreports

			# Account to deliver to.
			Account: postmaster

			# Mailbox to deliver to, e.g. TLSRPT.
			Mailbox: TLSRPT

# Accounts represent mox users, each with a password and email address(es) to
# which email can be delivered (possibly at different domains). Each account has
# its own on-disk directory holding its messages and index database. An account
# name is not an email address.
Accounts:
	postmaster:

		# Default domain for account. Deprecated behaviour: If a destination is not a full
		# address but only a localpart, this domain is added to form a full address.
		Domain: upper.town

		# Destinations, keys are email addresses (with IDNA domains). All destinations are
		# allowed for logging in with IMAP/SMTP/webmail. If no destinations are
		# configured, the account can not login. If the address is of the form '@domain',
		# i.e. with localpart missing, it serves as a catchall for the domain, matching
		# all messages that are not explicitly configured. Deprecated behaviour: If the
		# address is not a full address but a localpart, it is combined with Domain to
		# form a full address. (optional)
		Destinations:
			postmaster@upper.town: nil

		# If configured, messages classified as weakly spam are rejected with instructions
		# to retry delivery, but this time with a signed token added to the subject.
		# During the next delivery attempt, the signed token will bypass the spam filter.
		# Messages with a clear spam signal, such as a known bad reputation, are
		# rejected/delayed without a signed token. (optional)
		SubjectPass:

			# How long unique values are accepted after generating, e.g. 12h.
			Period: 12h0m0s

		# Mail that looks like spam will be rejected, but a copy can be stored temporarily
		# in a mailbox, e.g. Rejects. If mail isn't coming in when you expect, you can
		# look there. The mail still isn't accepted, so the remote mail server may retry
		# (hopefully, if legitimate), or give up (hopefully, if indeed a spammer).
		# Messages are automatically removed from this mailbox, so do not set it to a
		# mailbox that has messages you want to keep. (optional)
		RejectsMailbox: Rejects

		# Automatically set $Junk and $NotJunk flags based on mailbox messages are
		# delivered/moved/copied to. Email clients typically have too limited
		# functionality to conveniently set these flags, especially $NonJunk, but they can
		# all move messages to a different mailbox, so this helps them. (optional)
		AutomaticJunkFlags:

			# If enabled, junk/nonjunk flags will be set automatically if they match some of
			# the regular expressions. When two of the three mailbox regular expressions are
			# set, the remaining one will match all unmatched messages. Messages are matched
			# in the order 'junk', 'neutral', 'not junk', and the search stops on the first
			# match. Mailboxes are lowercased before matching.
			Enabled: true

			# Example: ^(junk|spam). (optional)
			JunkMailboxRegexp: ^(junk|spam)

			# Example: ^(inbox|neutral|postmaster|dmarc|tlsrpt|rejects), and you may wish to
			# add trash depending on how you use it, or leave this empty. (optional)
			NeutralMailboxRegexp: ^(inbox|neutral|postmaster|dmarc|tlsrpt|rejects)

		# Content-based filtering, using the junk-status of individual messages to rank
		# words in such messages as spam or ham. It is recommended you always set the
		# applicable (non)-junk status on messages, and that you do not empty your Trash
		# because those messages contain valuable ham/spam training information.
		# (optional)
		JunkFilter:

			# Approximate spaminess score between 0 and 1 above which emails are rejected as
			# spam. Each delivery attempt adds a little noise to make it slightly harder for
			# spammers to identify words that strongly indicate non-spaminess and use it to
			# bypass the filter. E.g. 0.95.
			Threshold: 0.950000
			Params:

				# Track ham/spam ranking for single words. (optional)
				Onegrams: true

				# Maximum power a word (combination) can have. If spaminess is 0.99, and max power
				# is 0.1, spaminess of the word will be set to 0.9. Similar for ham words.
				MaxPower: 0.010000

				# Number of most spammy/hammy words to use for calculating probability. E.g. 10.
				TopWords: 10

				# Ignore words that are this much away from 0.5 haminess/spaminess. E.g. 0.1,
				# causing word (combinations) of 0.4 to 0.6 to be ignored. (optional)
				IgnoreWords: 0.100000

				# Occurrences in word database until a word is considered rare and its influence
				# in calculating probability reduced. E.g. 1 or 2. (optional)
				RareWords: 2

		# If set, this account cannot set a password of their own choice, but can only set
		# a new randomly generated password, preventing password reuse across services and
		# use of weak passwords. Custom account passwords can be set by the admin.
		# (optional)
		NoCustomPassword: true

# DNS blocklists to periodically check with if IPs we send from are present,
# without using them for checking incoming deliveries.. Also see DNSBLs in SMTP
# listeners in mox.conf, which specifies DNSBLs to use both for incoming
# deliveries and for checking our IPs against. Example DNSBLs: sbl.spamhaus.org,
# bl.spamcop.net. (optional)
MonitorDNSBLs:
	- sbl.spamhaus.org
	- bl.spamcop.net
