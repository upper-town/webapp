<div class="card h-100 shadow-sm overflow-hidden">
  <% if ServerBannerImagePolicy.new(server, request).allowed? && server.banner_image.attached? %>
    <%= link_to(server_path(server), class: "text-decoration-none") do %>
      <%= image_tag(
        server.banner_image,
        class: "card-img-top",
        style: "height: 140px; object-fit: cover;"
      ) %>
    <% end %>
  <% end %>

  <div class="card-body d-flex flex-column">
    <div class="d-flex align-items-start gap-2 mb-2">
      <div class="flex-shrink-0 rounded-2 bg-primary text-white text-center px-2 py-1" style="min-width: 3rem;">
        <span class="fw-bold small"><%= format_ranking_number(server_stats_hash.dig(period, :ranking_number)) %></span>
      </div>
      <div class="flex-grow-1 min-w-0">
        <%= link_to(server.name, server_path(server), class: "fw-semibold text-decoration-none text-body") %>
        <div class="small text-body-secondary mt-1">
          <%= server.game.name %>
          <span title="<%= server.country.common_name %>"><%= server.country.emoji_flag %> <%= server.country_code %></span>
          <% if server.verified? %>
            <span class="badge bg-success ms-1"><%= t("servers.index.verified") %></span>
          <% end %>
        </div>
      </div>
    </div>

    <% if server.description.present? %>
      <p class="card-text small text-body-secondary mb-3">
        <%= truncate(server.description, length: 120) %>
      </p>
    <% end %>

    <div class="row g-2 mb-3">
      <div class="col-12">
        <div class="small text-body-secondary text-uppercase mb-1"><%= t("servers.index.world_ranking") %></div>
        <div class="d-flex gap-1">
          <% [Periods::YEAR, Periods::MONTH, Periods::WEEK].each do |p| %>
            <div class="flex-grow-1 rounded text-center py-1 <%= period == p ? "bg-primary bg-opacity-25 border border-primary" : "bg-body-secondary bg-opacity-25" %>">
              <div class="small text-body-secondary"><%= t("servers.index.#{p}") %></div>
              <div class="fw-semibold small"><%= format_ranking_number(server_stats_hash.dig(p, :ranking_number)) %></div>
            </div>
          <% end %>
        </div>
      </div>
      <div class="col-12">
        <div class="small text-body-secondary text-uppercase mb-1"><%= t("servers.index.vote_count") %></div>
        <div class="d-flex gap-1">
          <% [Periods::YEAR, Periods::MONTH, Periods::WEEK].each do |p| %>
            <div class="flex-grow-1 rounded text-center py-1 <%= period == p ? "bg-primary bg-opacity-25 border border-primary" : "bg-body-secondary bg-opacity-25" %>">
              <div class="small text-body-secondary"><%= t("servers.index.#{p}") %></div>
              <div class="fw-semibold small"><%= format_vote_count(server_stats_hash.dig(p, :vote_count)) %></div>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <div class="mt-auto d-flex gap-2 justify-content-center">
      <%= link_to(t("servers.index.vote_up"), new_server_vote_path(server), class: "btn btn-primary btn-sm") %>
      <% if show_more_info %>
        <%= link_to(t("servers.index.more_info"), server_path(server), class: "btn btn-outline-secondary btn-sm") %>
      <% end %>
    </div>
  </div>
</div>
