<h1 class="mb-4"><%= t("admin.admin_accounts.index.title") %></h1>

<% request_helper = RequestHelper.new(request) %>
<% sort_url_builder = ->(key, dir) { request_helper.url_with_query({ sort: key, sort_dir: dir, page: 1 }, []) } %>

<div class="admin-pagination-search-row mb-3">
  <div class="admin-pagination-search-row__pagination">
    <%= render(PaginationComponent.new(@pagination, align: :start)) %>
  </div>
  <%= render(Admin::SearchFormComponent.new(
    url: admin_admin_accounts_path,
    search_term: @search_term,
    placeholder: t("admin.admin_accounts.index.search_placeholder"),
    hidden_params: params.permit(:sort, :sort_dir).to_h.compact
  )) %>
</div>

<%=
  render(Admin::TableComponent.new(
    collection: @admin_accounts,
    empty_message: t("admin.admin_accounts.index.empty_message"),
    sort_column: @sort_column,
    sort_direction: @sort_direction,
    sort_url_builder: sort_url_builder,
    columns: [
      [t("admin.shared.id"), -> { link_to(it.id, admin_admin_account_path(it), class: "fw-medium") }, { copyable: :id, sortable: "id" }],
      [
        t("admin.admin_accounts.columns.admin_user"),
        -> { link_to(it.admin_user.email, admin_admin_user_path(it.admin_user)) },
        { copyable: ->(it) { it.admin_user&.email } },
      ],
      [
        t("admin.admin_accounts.columns.super_admin"),
        -> {
          it.super_admin? ? content_tag(:span, t("admin.shared.yes"), class: "badge text-bg-warning") : content_tag(:span, t("admin.shared.no"), class: "text-body-secondary")
        },
      ],
      [
        t("admin.admin_accounts.columns.roles"),
        -> {
          it.roles.any? ? it.roles.map(&:key).join(", ") : content_tag(:span, t("admin.shared.none"), class: "text-body-secondary")
        },
        { copyable: ->(it) { it.roles.any? ? it.roles.map(&:key).join(", ") : nil } },
      ],
      [t("admin.shared.created"), -> { l(it.created_at) }, { copyable: ->(it) { l(it.created_at) }, sortable: "created_at" }],
      [
        t("admin.shared.actions"),
        -> { render(Admin::IndexActionsComponent.new(view_path: admin_admin_account_path(it), edit_path: edit_admin_admin_account_path(it))) },
      ],
    ],
  ))
%>

<%= render(PaginationComponent.new(@pagination, align: :start)) %>
