<div class="mb-4">
  <h1 class="mb-0"><%= @user.email %></h1>
  <%= render(Admin::ShowActionsComponent.new(
    back_path: admin_users_path,
    actions: [
      (@user.account ? { path: admin_account_path(@user.account), label: t("admin.accounts.account") } : nil),
      (@user.account ? { path: account_path(@user.account), label: t("admin.shared.view_public_page"), target: "_blank", rel: "noopener noreferrer" } : nil),
      { path: edit_admin_user_path(@user), label: t("admin.shared.edit") },
    ].compact
  )) %>
</div>

<%= render(Admin::DetailsTableComponent.new(
  sections: [
    {
      title: t("admin.shared.details"),
      rows: [
        [t("admin.shared.id"), @user.id, { copyable: true }],
        [t("admin.users.columns.email"), @user.email, { copyable: true }],
        [
          t("admin.users.columns.email_confirmed"),
          -> {
            if @user.email_confirmed_at
              safe_join([content_tag(:span, t("admin.shared.yes"), class: "badge text-bg-success"), content_tag(:small, "(#{l(@user.email_confirmed_at)})", class: "text-body-secondary ms-1")])
            else
              content_tag(:span, t("admin.shared.no"), class: "badge text-bg-secondary")
            end
          },
          (@user.email_confirmed_at ? { copyable: l(@user.email_confirmed_at) } : {}),
        ],
        [
          t("admin.users.show.email_confirmation_sent"),
          @user.email_confirmation_sent_at ? l(@user.email_confirmation_sent_at) : nil,
          { copyable: true },
        ],
        [t("admin.users.show.change_email_pending"), @user.change_email.presence, { copyable: true }],
        [
          t("admin.users.show.change_email_confirmed"),
          @user.change_email_confirmed_at ? l(@user.change_email_confirmed_at) : nil,
          { copyable: true },
        ],
        [
          t("admin.shared.locked"),
          -> {
            if @user.locked?
              safe_join([
                content_tag(:span, t("admin.shared.locked"), class: "badge text-bg-danger"),
                content_tag(:small, "(#{l(@user.locked_at)})", class: "text-body-secondary ms-1"),
                @user.locked_reason.presence && content_tag(:span, @user.locked_reason, class: "ms-1"),
                @user.locked_comment.presence && content_tag(:div, simple_format(@user.locked_comment), class: "mt-1 text-body-secondary small"),
              ].compact, " ")
            else
              nil
            end
          },
        ],
        [t("admin.users.show.failed_sign_in_attempts"), @user.failed_attempts, { copyable: true }],
        [
          t("admin.users.show.password_reset_sent"),
          @user.password_reset_sent_at ? l(@user.password_reset_sent_at) : nil,
          { copyable: true },
        ],
        [t("admin.users.show.sign_in_count"), @user.sign_in_count, { copyable: true }],
        [t("admin.shared.created"), l(@user.created_at), { copyable: true }],
        [t("admin.shared.updated"), l(@user.updated_at), { copyable: true }],
      ],
    },
  ],
)) %>

<%= render(Admin::DetailsTableComponent.new(
  sections: [
    {
      title: t("admin.users.show.verified_servers"),
      rows: @user.account&.verified_servers&.any? ? @user.account.verified_servers.map { |server| [link_to(server.name, admin_server_path(server))] } : [[-> { content_tag(:span, t("admin.shared.none"), class: "text-body-secondary") }]],
    },
  ],
)) %>

<%= turbo_frame_tag("user_sessions", src: sessions_admin_user_path(@user), loading: :lazy) do %>
  <div class="card mb-4">
    <div class="card-body text-center text-body-secondary py-5">
      <p class="mb-0"><%= t("admin.shared.loading") %></p>
    </div>
  </div>
<% end %>

<%= turbo_frame_tag("user_tokens", src: tokens_admin_user_path(@user), loading: :lazy) do %>
  <div class="card mb-4">
    <div class="card-body text-center text-body-secondary py-5">
      <p class="mb-0"><%= t("admin.shared.loading") %></p>
    </div>
  </div>
<% end %>

<%= turbo_frame_tag("user_codes", src: codes_admin_user_path(@user), loading: :lazy) do %>
  <div class="card mb-4">
    <div class="card-body text-center text-body-secondary py-5">
      <p class="mb-0"><%= t("admin.shared.loading") %></p>
    </div>
  </div>
<% end %>
