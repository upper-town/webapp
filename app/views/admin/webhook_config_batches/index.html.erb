<%= turbo_frame_tag "webhook_config_batches" do %>
  <div class="card mb-4">
    <div class="card-header">
      <h5 class="card-title mb-0"><%= t("admin.webhook_configs.show.batches") %></h5>
    </div>
    <div class="card-body">
      <div class="admin-pagination-search-row mb-3">
        <div class="admin-pagination-search-row__pagination">
          <%= render(PaginationComponent.new(@pagination, align: :start)) %>
        </div>
        <%= render(Admin::SearchFormComponent.new(
          url: batches_admin_webhook_config_path(@webhook_config),
          search_term: @search_term,
          placeholder: t("admin.webhook_batches.index.search_placeholder")
        )) %>
      </div>

      <%=
        render(Admin::TableComponent.new(
          collection: @webhook_batches,
          empty_message: t("admin.webhook_batches.index.empty_message"),
          columns: [
            [
              t("admin.shared.id"),
              -> { link_to(it.id, admin_webhook_batch_path(it), class: "fw-medium", data: { turbo_frame: "_top" }) },
              { copyable: :id },
            ],
            [
              t("admin.webhook_batches.columns.status"),
              -> {
                badge_class = case it.status
                when "delivered" then "bg-success"
                when "failed" then "bg-danger"
                when "queued" then "bg-primary"
                else "bg-secondary"
                end
                content_tag(:span, it.status, class: "badge #{badge_class}")
              },
            ],
            [t("admin.webhook_batches.columns.failed_attempts"), -> { it.failed_attempts }],
            [t("admin.webhook_batches.columns.events"), -> { it.events.size }],
            [t("admin.shared.created"), -> { l(it.created_at) }, { copyable: ->(it) { l(it.created_at) } }],
            [
              t("admin.shared.actions"),
              -> {
                render(Admin::IndexActionsComponent.new(
                  view_path: admin_webhook_batch_path(it),
                  link_options: { data: { turbo_frame: "_top" } },
                ))
              },
            ],
          ],
        ))
      %>

      <%= render(PaginationComponent.new(@pagination, align: :start)) %>
    </div>
  </div>
<% end %>
